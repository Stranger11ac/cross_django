function getCSRFToken(){for(var t=document.cookie.split(";"),e=0;e<t.length;e++){var o=jQuery.trim(t[e]);if("csrftoken="==o.substring(0,10))return decodeURIComponent(o.substring(10))}const a=$("[name=csrfmiddlewaretoken]").val();return a}function cadenaRandom(t,e){for(var o="",a=0;a<t;a++){var n=Math.floor(Math.random()*e.length);o+=e.charAt(n)}return o}function jsonSubmit(t){t.preventDefault=t.preventDefault||function(){},t.preventDefault();const e=t.target,o=new FormData(e);if(o.has("contenidoWord")){const t=tinymce.activeEditor.getContent();o.set("contenidoWord",t);const e=tinymce.activeEditor.getContent({format:"text"});o.set("textTiny",e)}fetch(e.action,{method:"POST",body:o,headers:{"X-Requested-With":"XMLHttpRequest","X-CSRFToken":formToken}}).then(t=>t.ok?t.json():t.json().then(t=>{throw new Error(t.message||"Error desconocido")})).then(t=>{if(dataMessage=t.message,t.success){function e(e){window.location.href=t.redirect_url}if(dataIcon="success",t.icon&&(dataIcon=t.icon),dataPosition="center",t.position&&(dataPosition=t.position),"singin"==t.functions)return void e();if("reload"==t.functions)var o=function(){location.reload()};else if("redirect"==t.functions)o=function(){e()};const a=document.querySelectorAll('input[type="password"]');a.forEach(t=>t.value=""),alertSToast(dataPosition,timerOut,dataIcon,dataMessage,o)}else console.error(dataMessage),alertSToast("top",timerOut+2e3,"warning",dataMessage)}).catch(t=>{console.error("üò• Error:",t),errorMessage=t.message||"Ocurri√≥ un error. Intente nuevamente. üò•",alertSToast("center",timerOut+3e3,"error",errorMessage)})}function chatSubmit(t){t.preventDefault();const e=txtQuestion.value,o=t.target;if(this.reset(),!texto3.test(e))return alertSToast("center",6e3,"warning","Por favor, escribe una pregunta üßêüò¨");var a=cadenaRandom(5,alfabetico);const n=`uuid${a}`,s=`<div class="output_block"><div class="btn_detail chat_msg user_submit" data-tokeid="${n}">${e}</div></div>`;contOutput.insertAdjacentHTML("beforeend",s);const r=document.querySelector(`.user_submit[data-tokeid="${n}"]`);setTimeout(function(){r.classList.add("visible"),setTimeout(scrollToBottom,500)},20),fetch(o.action,{method:"POST",body:JSON.stringify({question:e}),headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRFToken":o.querySelector("[name=csrfmiddlewaretoken]").value}}).then(t=>t.ok?t.json():t.json().then(t=>{throw new Error(t.message||"Error desconocido")})).then(t=>{if(t.success){console.table(t.answer);const e=t.answer.imagenes,o=t.answer.redirigir;console.log("img:"+typeof e),console.log("url:"+typeof o);let a="",s="";null!=e&&(a=`<br><br> <img src="${e}" class="img-fluid rounded" width="350">`),null!=o&&(s=`<br><br> <a class="btn btn_detail mb-2" style="min-width:300px;" target="_blank" rel="noopener noreferrer" href="${o}" >Ver Mas <i class="fa-solid fa-arrow-up-right-from-square ms-1"></i></a>`);const r=`<div class="chat_msg asistent_response" data-tokeid="${n}"><span>${t.answer.informacion}  ${s} </span><span>${a} </span></div>`;contOutput.insertAdjacentHTML("beforeend",r);const i=document.querySelector(`.asistent_response[data-tokeid="${n}"]`);setTimeout(function(){setTimeout(function(){i.classList.add("visible"),setTimeout(scrollToBottom,350)},970)},20)}else alertSToast("top",8e3,"error",`Error: ${t.message}`)}).catch(t=>{console.error("üò• Error:",t),alertSToast("top",8e3,"warning","Ocurri√≥ un error. Intente nuevamente. üò•")})}function scrollToBottom(){contOutput.scrollTop=contOutput.scrollHeight}function copyValInput(){const t=document.querySelectorAll("input[data-copy]");t.forEach(t=>{const e=()=>{if(!navigator.clipboard)return void alertSToast("center",8e3,"info","Tu navegador no admite copiar al portapapeles üòØüò•ü§î");const e=t.value;""!=e&&navigator.clipboard.writeText(e).then(()=>{alertSToast("top",5e3,"success","Texto Copiado! ü•≥")}).catch(t=>{const e="Error al copiar al portapapeles";console.error(e,":",t),alertSToast("top",8e3,"error",`${e} ü§îüò•`)})};t.addEventListener("click",e),t.addEventListener("focus",e)})}function alertSToast(t,e,o,a,n){const s=Swal.mixin({toast:!0,position:t,showConfirmButton:!1,showCloseButton:!0,timer:e,timerProgressBar:!0,didOpen:t=>{t.addEventListener("mouseenter",Swal.stopTimer),t.addEventListener("mouseleave",Swal.resumeTimer)},didDestroy:n});s.fire({icon:o,title:a})}var alfabetico="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",alfanumerico="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",caracteres="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-%$#@!*&^.",texto3=/[a-zA-Z0-9]{3}/,formToken=getCSRFToken(),timerOut=5e3;$(document).ready(function(){try{$(".modal").on("shown.bs.modal",function(t){$("body").addClass("body_minus")}),$(".modal").on("hidden.bs.modal",function(t){$("body").removeClass("body_minus")});var t=$("#searchInput");function e(){var e=t.val().toLowerCase();$("#searchInput").text(e);$(".results_item").filter(function(){return $(this).toggle($(this).text().toLowerCase().indexOf(e)>-1),$(this).is(":visible")}).length}t.on("input",e),$(".controls_btn_microphone").click(()=>{$(".asistent_group").addClass("open open_controls bg-body-tertiary"),$(".btn_controls").addClass("btn_detail").removeClass("btn_secondary"),$("#btn_controls_icon").removeClass("fa-comment text_detail").addClass("fa-microphone")}),$(".toggle_controls").click(()=>{$(".asistent_group.open").toggleClass("close_controls open_keyboard open_controls");const t=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);t||setTimeout(function(){$(".controls_input #question").focus()},1e3)}),$(".controls_btn_close").click(()=>{$(".asistent_group").removeClass("open open_controls close_controls open_keyboard bg-body-tertiary"),$(".btn_controls").removeClass("btn_detail").addClass("btn_secondary"),$("#btn_controls_icon").addClass("fa-comment text_detail").removeClass("fa-microphone")});var o=1/0;let d=null;function a(){$(this).addClass("active");var t=cadenaRandom(8,caracteres),e=$(this).data("editinput");setTimeout(()=>{$(this).removeClass("active")},1e3),$("#"+e).val(t).focus()}function n(){const t=["#4285F4","#EA4335","#FBBC05","#4285F4","#34A853","#EA4335"],e=$(".style_google"),o=e.text();e.empty();for(let a=0;a<o.length;a++)e.append(`<span style="color:${t[a]}">${o[a]}</span>`)}function s(t,e){t&&$.ajax({url:e,type:"GET",data:{id:t},success:function(t){$("#isNewEdif").prop("checked",!1),$("#groupTitleMap").hide(),$(".img_form_map").slideDown(),$("#cancelNewEdif").show(),$("#mapTitle").text(t.titulo),$("#formTitle").val(t.titulo),tinymce.get("textTiny").setContent(t.informacion);const e=t.imagen_url;let o,a;t.imagen_url?($("#suggestImg").hide(),o=e.replace("/cross_asistent",""),a="(Opcional)"):($("#suggestImg").show(),o="/static/img/default_image.webp",a="(fachada)"),$("#suggestImgText").text(a),$("#imagen_actual").attr("src",o)}})}$('[id^="bannerid_"]').each(function(){var t=$(this).attr("id"),e=parseInt(t.split("_")[1]);e<o&&(o=e,d=$(this))}),null!==d&&d.addClass("active"),$("#txtQuestion").keydown(t=>{13!==t.keyCode||t.shiftKey||(t.preventDefault(),$("#chatForm_submit").click())}),$("#chatForm").submit(chatSubmit),$("[data-submit-form]").submit(jsonSubmit),$("button[data-editinput]").click(a),$("[data-btn_closed]").on("click",function(){var t=$(this).data("btn_closed");$("#"+t).toggleClass("show")}),$("[data-reset_form]").on("click",function(){var t=$(this).data("reset_form"),e=$("#"+t)[0];e&&e.reset()}),n(),$(document).on("keydown",function(t){"Escape"!==t.key&&27!==t.keyCode||Swal.close()}),$("#cancelNewEdif").on("click",function(){$("#groupTitleMap").slideToggle("fast"),$("#cancelNewEdif").slideToggle("fast"),$(".img_form_map").slideToggle(),$("#isNewEdif").prop("checked",!0),$("#mapTitle").text(""),$("#formTitle").val(""),$("#textTiny").setContent("")}),$("#selectEdif").change(function(){var t=$(this).val();const e=$(this).data("second-action");s(t,e)}),$("#color_picker").on("input",function(){var t=$(this).val();$("#color").val(t),$("#colorVal").text(t)});const u=$("input[data-init-clear], textarea[data-init-clear]");u.each(function(){$(this).on("input",function(){let t=$(this).attr("id"),e=$(`[data-clear="${t}"]`);""==$(this).val()?e.hide():e.show()})});const m=$("[data-clear]");m.on("click",function(){const t=$(this).attr("data-clear");$(`#${t}`).val(""),$(this).slideUp("fast")}),$("#markAsReadButton").on("click",function(){$('[id^="notif_"]').each(function(){$(this).removeClass("list-group-item-warning list-group-item-info list-group-item-success list-group-item-danger list-group-item-primary")}),$('[id^="notif_"]').each(function(){$(this).addClass("list-group-item-secondary")});var t=[];$('[id^="notif_"]').each(function(){t.push($(this).attr("id"))}),localStorage.setItem("notificationIds",JSON.stringify(t))}),$(".notification-checkbox").on("change",function(){var t=$(this),e=t.data("id"),o=t.data("val-post"),a=[e];$.ajax({url:o,method:"POST",data:JSON.stringify({ids:a}),contentType:"application/json",headers:{"X-CSRFToken":formToken},success:function(e){message=e.message,"success"===e.status?(t.closest("li").removeClass("list-group-item-warning list-group-item-info list-group-item-success list-group-item-danger list-group-item-primary").addClass("list-group-item-secondary"),setTimeout(()=>{t.slideUp()},2e3)):console.error(message),alertSToast("top",4e3,e.icon,message)}})}),$("[data-change-color]").on("click",function(){$("[data-change-color]").each(function(t,e){$(e).removeClass("active")});var t=$(this).addClass("active").data("change-color"),e=$(this).data("rgb");$("body").attr("data-color_prefer",t),localStorage.setItem("data-color_prefer",t),localStorage.setItem("data-color_rgb",e)}),$("#switchTheme").on("click",function(){$("#switchTheme").is(":checked")?($("#switchText").text("Claro"),$("html").attr("data-mdb-theme","light"),localStorage.setItem("data-mdb-theme","light"),localStorage.setItem("mapbox-last_layer","light-v11")):($("#switchText").text("Oscuro"),$("html").attr("data-mdb-theme","dark"),localStorage.setItem("data-mdb-theme","dark"),localStorage.setItem("mapbox-last_layer","dark-v11"))});var r=JSON.parse(localStorage.getItem("notificationIds"))||[];r.forEach(function(t){$("#"+t).removeClass("list-group-item-warning list-group-item-info list-group-item-success list-group-item-danger list-group-item-primary"),$("#"+t).addClass("list-group-item-secondary")});const f=localStorage.getItem("data-color_prefer");f?($(`[data-change-color="${f}"]`).addClass("active"),$("body").attr("data-color_prefer",f)):($('[data-change-color="blue"]').addClass("active"),$("body").attr("data-color_prefer","blue"));const p=localStorage.getItem("data-mdb-theme");p&&("light"==p?($("#switchText").text("Claro"),$("#switchTheme").prop("checked",!0),$("html").attr("data-mdb-theme","light"),localStorage.setItem("mapbox-last_layer","light-v11")):($("#switchText").text("Oscuro"),$("#switchTheme").prop("checked",!1),$("html").attr("data-mdb-theme","dark"),localStorage.setItem("mapbox-last_layer","dark-v11")));const g=$.trim($("#firmaPerfilTexto").text());function i(t){if(t.files&&t.files[0]){var e=new FileReader;e.onload=function(t){$("[data-img_dom]").attr("src",t.target.result)},e.readAsDataURL(t.files[0])}}function c(t){$(t).toggleClass("input_transparent")}$("#new_firma").on("input",function(){const t=$(this).val();""===t.trim()?$("#firmaPerfilTexto").text(g):$("#firmaPerfilTexto").text(t)}),$("[data-img_dom-change]").change(function(){i(this)}),$("[data-input_transparent]").on({focus:function(){c(this)},blur:function(){c(this)}});var l=!1;$("#updatePassBtn").on("click",function(){let t=$(this);$("#updatePassText").toggle(),$("#updatePassBtn").hasClass("bg_blue-green")?$("#profileSaved").slideDown("fast",function(){$("#updatePassBlock").slideDown("fast",function(){$("html, body").scrollTop($(document).height())})}):l?$("#updatePassBlock").slideUp("fast"):$("#profileSaved").slideUp("fast",function(){$("#updatePassBlock").slideUp("fast")}),"Cambiar Contrase√±a"==t.text()?(t.toggleClass("bg_blue-green bg_blue-red"),t.text("No Cambiar Contrase√±a"),l?($("#newPass").val(""),$("#confNewPass").val("")):($("#passwordSend").val(""),$("#newPass").val(""),$("#confNewPass").val(""))):(t.toggleClass("bg_blue-green bg_blue-red"),t.text("Cambiar Contrase√±a"))}),$("[data-input_change]").each(function(){const t=$(this);var e=t.val();const o=t.attr("name");t.on("input",function(){t.val()==e?(t.attr("name",`${o}`),$("#profileSaved").slideUp("fast"),l=!1):(t.attr("name",`${o}Changed`),$("#profileSaved").slideDown("fast"),l=!0,""==t.val()&&t.attr("name",`${o}`))}),t.on("click",function(){o})}),$("input#deletePicture").change(function(){$(this).is(":checked")?($('[for="deletePicture"]').addClass("btn_press"),$("#profileSaved").slideDown("fast"),l=!0):($('[for="deletePicture"]').removeClass("btn_press"),$("#profileSaved").slideUp("fast"),l=!1)})}catch(t){console.error("Error Inesperado: ",t),alertSToast("center",8e3,"error","üò• Ah ocurrido un error JQ.")}}),document.querySelector("main").classList.contains("main_container")&&(window.location.href="/logout");var contOutput=document.querySelector("#output"),btnCloseChat=$("#closeChat");if(btnCloseChat&&contOutput&&btnCloseChat.on("click",function(){const t=`uuid${cadenaRandom(5,alfabetico)}`,e="Hola üëã ¬°Bienvenido! Soy tu asistente virtual ¬øEn qu√© puedo ayudarte hoy?",o=`<div class="btn_detail chat_msg asistent_response" data-tokeid="${t}"><span>${e}</span></div>`;contOutput.insertAdjacentHTML("beforeend",o);const a=document.querySelector(`.asistent_response[data-tokeid="${t}"]`);setTimeout(function(){a.classList.add("visible"),scrollToBottom()},20)}),contOutput){function scrollToBottom(){contOutput.scrollTop=contOutput.scrollHeight}var observer=new MutationObserver(()=>{scrollToBottom()});scrollToBottom(),observer.observe(contOutput,{childList:!0,subtree:!0})}copyValInput(),document.oncontextmenu=function(){return!1};var imagesZoom=document.querySelectorAll(".materialBoxed"),instances=M.Materialbox.init(imagesZoom);