var mapToken="pk.eyJ1Ijoic2FsdmFoZHotMTEiLCJhIjoiY2x3czBoYTJiMDI1OTJqb2VmZzVueG1ocCJ9.dDJweS7MAR5N2U3SF64_Xw";const inputs=document.querySelectorAll("#offcanvasbody input[type='radio']"),formRoute=document.querySelector("#form_route"),selectOrigin=formRoute.querySelector("#origen"),selectDestiny=formRoute.querySelector("#destino"),resetRoutBtn=formRoute.querySelector("[data-reset_form]"),delRoutBtn=formRoute.querySelector("[data-del_route]");var offcanvas=document.getElementById("infoLateral"),offcanvasElement=new bootstrap.Offcanvas(offcanvas);let colorlabels="#000";var currentMarker;let currentRoute;mapboxgl.accessToken=mapToken;const map=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[-100.93655,25.55701],zoom:16,maxZoom:20,minZoom:15,maxBounds:[[-100.9736,25.5142],[-100.9117,25.5735]]});map.addControl(new mapboxgl.NavigationControl);class CustomControl{constructor(){this._container=null}onAdd(e){this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl mapboxgl-ctrl-group";const t=(e,t,o,a)=>{const n=document.createElement("button");return n.className="mapboxgl-ctrl-"+e,n.innerHTML=t,n.title=o,n.type="button",n.onclick=a,n},o=t("gmaps",'<div class="mapboxgl-ctrl-icon"><i class="fa-solid fa-map-location-dot"></i></div>',"Google Maps",()=>{var e=new mdb.Modal(document.getElementById("beforeSend"));e.show()}),a=t("virtual",'<i class="fa-solid fa-cube"></i>',"Recorrido Virtual",()=>{console.log("Alerta 1 activada")}),n=t("styles",'<i class="fa-solid fa-layer-group"></i>',"Cambiar Aspecto",()=>{const e=new bootstrap.Offcanvas(document.querySelector("#offcanvasBottom"));e.show()}),r=t("route",'<div class="mapboxgl-ctrl-icon" data-btn_closed="controls_route"><i class="fa-solid fa-route"></i></div>',"Como ir a...");return this._container.appendChild(o),this._container.appendChild(a),this._container.appendChild(n),this._container.appendChild(r),this._container}}const customControl=new CustomControl;map.addControl(customControl,"top-right"),document.addEventListener("DOMContentLoaded",function(){const e=document.querySelector("#map").getAttribute("data-mapa_edif");fetch(e).then(e=>e.json()).then(e=>{function t(){map.getSource("places")||map.addSource("places",{type:"geojson",data:e}),map.getLayer("places-layer")||map.addLayer({id:"places-layer",type:"fill",source:"places",paint:{"fill-color":["get","color"],"fill-opacity":.4}}),map.getLayer("places-label")||(map.addLayer({id:"places-label",type:"symbol",source:"places",layout:{"text-field":["get","nombre"],"text-size":12,"text-offset":[0,-.6],"text-anchor":"top"},paint:{"text-color":colorlabels}}),map.moveLayer("places-label")),map.getLayer("smooth-path")||map.addLayer({id:"smooth-path",type:"line",source:"places",filter:["==",["get","type"],"smooth_path"],paint:{"line-color":"green","line-width":4}}),map.getLayer("stairs")||map.addLayer({id:"stairs",type:"line",source:"places",filter:["==",["get","type"],"stairs"],paint:{"line-color":"blue","line-width":4}}),map.getLayer("streets")||map.addLayer({id:"streets",type:"line",source:"places",filter:["==",["get","type"],"street"],paint:{"line-color":"darkgray","line-width":4}})}function o(e){currentMarker&&currentMarker.remove(),currentMarker=new mapboxgl.Marker({draggable:!1,color:"#3b71ca"}).setLngLat(e).addTo(map)}function a(){const t=selectOrigin.value,o=selectDestiny.value;if(t&&o&&t!==o){const a=e.features.find(e=>e.properties.nombre===t),n=e.features.find(e=>e.properties.nombre===o);if(a&&n){const e=a.properties.door,t=n.properties.door;i.setOrigin(e),i.setDestination(t),$("#buttons_route").slideDown("fast"),i.on("route",e=>{currentRoute=e.route[0].geometry}),map.addControl(i,"top-left")}}else alertSToast("center",5e3,"warning","Por favor, selecciona tanto origen como destino.")}function n(){formRoute.querySelectorAll("option").forEach(e=>{e.disabled=!1})}function r(){map.addSource("directions",{type:"geojson",data:currentRoute}),map.addLayer({id:"directions-route-line",type:"line",source:"directions",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3b9ddd","line-width":8}}),map.moveLayer("places-label")}function l(){map.getStyle().layers.forEach(function(e){"symbol"===e.type&&e.layout["text-field"]&&map.setLayoutProperty(e.id,"visibility","none")})}map.on("load",function(){l(),t()}),map.on("style.load",function(){l(),t(),r()}),map.on("click",function(e){const t=e.lngLat;o(t)}),map.on("click","places-layer",e=>{const t=e.features[0],{nombre:o,informacion:a,imagen_url:n}=t.properties;document.getElementById("lateralTitle").innerText=o,document.getElementById("imagen_actual").src=n;const r=document.getElementById("offcanvasContent");r.innerHTML=`<div class="feature-info"><p>${a}</p></div>`,offcanvasElement.show()}),inputs.forEach(e=>{e.addEventListener("click",function(e){const t=e.target.id,o=document.querySelector(`label[for='${t}']`);document.querySelectorAll("#offcanvasbody label").forEach(e=>{e.classList.remove("btn_detail","text-white")}),inputs.forEach(e=>{e.removeAttribute("disabled")}),o.classList.add("btn_detail","text-white"),this.setAttribute("disabled","disabled"),colorlabels="dark-v11"===t?"#fff":"#000",map.getLayer("directions-route-line")&&(currentRoute=map.getSource("directions")._data),map.setStyle("mapbox://styles/mapbox/"+t)})});const s=e.features.map(e=>e.properties.nombre).sort();s.forEach(e=>{const t=new Option(e,e);document.getElementById("origen").add(t),document.getElementById("destino").add(t.cloneNode(!0))}),selectOrigin.addEventListener("change",function(){const e=this.value;selectDestiny.querySelectorAll("option").forEach(t=>{t.value===e?t.disabled=!0:t.disabled=!1})}),selectDestiny.addEventListener("change",function(){const e=this.value;selectOrigin.querySelectorAll("option").forEach(t=>{t.value===e?t.disabled=!0:t.disabled=!1})}),selectOrigin.addEventListener("change",function(){document.getElementById("destino").value&&a()}),selectDestiny.addEventListener("change",function(){document.getElementById("origen").value&&a()});const i=new MapboxDirections({accessToken:mapboxgl.accessToken,unit:"metric",profile:"mapbox/walking",controls:{inputs:!1,instructions:!1,profileSwitcher:!1},alternatives:!0,interactive:!1});resetRoutBtn.addEventListener("click",n),delRoutBtn.addEventListener("click",function(){map.getLayer("directions-route-line")&&map.removeLayer("directions-route-line"),i&&map.removeControl(i),n(),r()})}).catch(e=>console.error("Error al obtener los datos del mapa:",e))}),map.getCanvas().style.cursor="default",map.on("dragstart",()=>{map.getCanvas().style.cursor="move"}),map.on("dragend",()=>{map.getCanvas().style.cursor="default"}),map.on("mousedown",()=>{map.getCanvas().style.cursor="pointer"}),map.on("mouseup",()=>{map.getCanvas().style.cursor="default"}),map.on("mouseover",()=>{map.getCanvas().style.cursor="default"});